# 노랑풍선 명세서 — 대시보드 자료 → 템플릿 매핑

> 성원플라워 관리 대시보드(orders 테이블)의 **어떤 필드**가 템플릿 **어느 칸**에 들어가는지 정리.

---

## 용어 대응 (템플릿 ← 대시보드 입력)

| 템플릿 열 | 템플릿 헤더 | 대시보드 입력 항목 |
|-----------|-------------|---------------------|
| F | 배송지 | **배송장소** |
| G | 거래처 명 | **지점명** (임직원이면 "본인결혼") |
| H | 요청팀 | **요청부서** |
| I | 수령인 | **받는이** |
| J | 금액 | **판매가** (× 수량) |

---

## 1. 데이터 출처

- **대상:** Supabase `orders` 테이블에서 `client = '노랑풍선'` 이고, 선택한 기간(`date` between dateFrom ~ dateTo)인 행.
- **정렬:** `date` 오름차순.

---

## 2. 템플릿 열 구조 (엑셀 A~K)

| 열 | 템플릿 헤더 | 대시보드(Order) 필드 | 비고 |
|----|-------------|----------------------|------|
| **A** | 구분 | (자동) | 장례식 블록 첫 행만 `"거래처"`, 나머지·임직원·사내조경은 빈칸 |
| **B** | No | (자동) | 1, 2, 3… 블록 안에서 순번 |
| **C** | 배달일자 | **`date`** (배송일) | 주문의 배송일 = 배달일자(YYYY-MM-DD) |
| **D** | 상품명 | **`item`** (품목) | 아래 "상품명 규칙" 참고 (결혼→결혼화환, 장례식장→근조화환) |
| **E** | 발주자 | **거래처 담당자** | `client_contacts` 테이블에서 **노랑풍선**의 `contact_name`(담당자 이름). 미등록 시 **"이상훈"** |
| **F** | 배송지 | **`location`** (배송장소) + **`delivery_detail_address`** (세부주소) | 배송장소에 세부주소(호실 등) 있으면 공백 붙여서 한 칸에 |
| **G** | 거래처 명 / 사유 | **`branch`** (지점명) 또는 **`client`** | 대시보드 **지점명**. 임직원이면 **"본인결혼"** |
| **H** | 요청팀 | **`request_department`** (요청부서) | 대시보드 **요청부서** 입력값 |
| **I** | 수령인 | **`recipient`** (받는이) | 대시보드 **받는이** 입력값 |
| **J** | 금액 | **`price` × `quantity`** (판매가) | 대시보드 **판매가** × 수량 |
| **K** | 비고 | **`notes`** (특이사항) | 대시보드 **특이사항** 입력값 (블록/사유 판단에 쓰인 "본인결혼", "기타·조경" 포함 전체) |

---

## 3. 상품명 규칙 (D열)

- **`item`**에 "결혼" 또는 "결혼화환" 포함 → D열 **"결혼화환"**
- **`location`**에 "장례식장" 포함 → D열 **"근조화환"**
- 그 외 → D열에는 **`item`** 그대로 (없으면 빈칸)

---

## 4. 블록 구분 (어디 행에 넣는지)

- **거래처 블록 (4~24행):**  
  `branch` 또는 `client`에 **"노랑풍선"이 없고**,  
  `item`/`notes`에 "기타·조화·조경"이 **없는** 주문 → **장례식** → 이 블록에 채움.

- **임직원 블록 (27~31행):**  
  - `branch` 또는 `client`에 **"노랑풍선"** 포함 **또는**  
  - **특이사항(`notes`)** 에 **"본인결혼"** 이라고 쓰면  
  → **임직원** 블록에 넣고, G열 **사유**에 **"본인결혼"** 입력.

- **사내조경 (32행):**  
  `item` 또는 `notes`에 **"기타·조화·조경"** 포함 → **기타** → 32행 1건만 채움.

---

## 5. 요약 — 대시보드에서 꼭 쓰는 필드

| 대시보드 필드 | 템플릿에서 쓰는 곳 |
|---------------|---------------------|
| `date` (배송일) | C 배달일자 |
| `item` (품목) | D 상품명 (규칙 적용) |
| **client_contacts.contact_name** (노랑풍선 담당자) | E 발주자 (미등록 시 "이상훈") |
| `location` (배송장소) | F 배송지, D 상품명(근조화환 판단) |
| `delivery_detail_address` (세부주소) | F 배송지 (배송장소 뒤에 공백 붙여서) |
| `branch` (지점명) | G 거래처 명 (임직원이면 "본인결혼") |
| `client` | G 거래처 명 (지점명 없을 때), 블록 구분 |
| `request_department` (요청부서) | H 요청팀 |
| `recipient` (받는이) | I 수령인 |
| `price` (판매가) | J 금액 (× quantity) |
| `quantity` | J 금액 (판매가 × 수량) |
| `notes` (특이사항) | "본인결혼" 있으면 → **임직원** 블록, G열 사유 "본인결혼". "기타·조화·조경" 있으면 → 사내조경. **K 비고**에는 특이사항 전체 입력 |

**발주자:** [거래처 관리]에서 **노랑풍선** 선택 후 **담당자 이름**에 등록한 값이 E열에 들어감. 등록 안 되어 있으면 "이상훈".  
**고정값:** 임직원일 때 G = "본인결혼".

---

## 6. 템플릿 열 정의 여부 점검

| 템플릿 열 | 헤더 | 정의됨 | 대입 소스 |
|-----------|------|--------|------------|
| A | 구분 | ✅ | 자동(거래처/빈칸) |
| B | No | ✅ | 자동 순번 |
| C | 배달일자 | ✅ | date (배송일) |
| D | 상품명 | ✅ | item (품목) + 규칙 |
| E | 발주자 | ✅ | client_contacts (노랑풍선 담당자) |
| F | 배송지 | ✅ | location (배송장소) |
| G | 거래처 명 / 사유 | ✅ | branch (지점명) 또는 본인결혼 |
| H | 요청팀 | ✅ | request_department (요청부서) |
| I | 수령인 | ✅ | recipient (받는이) |
| J | 금액 | ✅ | price × quantity (판매가) |
| K | 비고 | ✅ | notes (특이사항) |

→ **템플릿 11개 열 모두 정의됨.**

---

## 7. Order 필드 중 명세서에 안 넣는 것

| Order 필드 | 비고 |
|------------|------|
| `id`, `created_at` | 식별/시스템용 |
| `provider` (플랫폼) | 명세서 양식에 없음 |
| `partner`, `partner_rating`, `partner_reason` | 수주화원 등 |
| `delivery_photo`, `delivery_photo_2` | 배송사진 |
| `cost` (발주가), `profit` (수익) | 명세서에는 판매가(J)만 사용 |
| `orderer_name`, `orderer_phone` (주문자) | 발주자 E열은 client_contacts 담당자 사용 |
| `region` (지역) | 명세서 열 없음 |
| `sender` (보내는이) | 명세서 열 없음 — **정의:** 명세서에는 미기입 |
| `delivery_detail_address` (세부주소) | ✅ F 배송지 (배송장소 뒤에 공백 붙여서) |
| `notes` (특이사항) | 블록/사유 판단 + **K 비고**에 전체 입력 |

---

## 8. 반영 완료

- **F 배송지:** `location` + (세부주소 있으면 ` " " + delivery_detail_address`) 로 코드 반영함.
- **K 비고:** `notes`(특이사항) 전체를 K열에 넣도록 코드 반영함.

---

*작성: 2026년 2월 — 노랑풍선 명세서 데이터 매핑*
