# 노랑풍선 명세서(엑셀) 수정 — 작업 문서

> 일반형·엔타스형(HTML 인쇄)은 적용했는데 **노랑풍선 엑셀**만 실패했을 때, 이 문서 주고 "이거 보면서 노랑풍선만 적용해줘" 하면 됨.

---

## 1. 목표

- 대시보드에 있는 **노랑풍선 주문**을 **엑셀 템플릿**에 채워서 다운로드되게 함.
- 지금처럼 **평면 파일**(`2026년_경조화환발주내역_성원플라워_날짜.xlsx`)이 아니라, **템플릿 양식**(`2026년_N월_채움_결과.xlsx`)으로 나와야 함.

---

## 2. 수정할 파일

- **`src/App.tsx`** (dashboard 폴더 기준)
- **대상:** `buildYellowBalloonWorkbook`, `fillYellowBalloonSheet`, `setCell`, `clearYellowBalloonDataRows`, `isMonthSheetName` 등 노랑풍선 엑셀 관련 로직.

---

## 3. 필수 수정 내용

### 3-1. 템플릿 시트 찾기 보강

- **현재 문제:** 템플릿에 "1월" 시트만 있으면 2월로 내보낼 때 "2월" 시트를 못 찾아서 **평면 파일**로 떨어짐.
- **수정:** 해당 월 시트가 없으면 **첫 번째 "N월" 형식 시트**(예: "1월")를 찾아서 그 시트에 데이터 채우기.
- **함수 추가:** `isMonthSheetName(name)` — 시트 이름이 `"1월"`, `"2월"` 같은지 판별 (공백·전각 숫자 허용).
- **buildYellowBalloonWorkbook 안에서:**  
  `targetSheet = wb.SheetNames.includes(sheetName) ? sheetName : wb.SheetNames.find(n => isMonthSheetName(n))`  
  로 사용할 시트 결정.

### 3-2. 템플릿은 그대로 두고 내용만 수정

- **setCell:** 셀에 값 쓸 때, 기존 셀에 스타일(`s`)이 있으면 **값(`v`)만 바꾸고** `s`는 유지.
- **clearYellowBalloonDataRows:** 데이터 영역(거래처 4~24행, 임직원 27~31행, 사내조경 32행) 셀을 비울 때도 **값만 지우고** 스타일 유지.
- **템플릿 읽기:** `XLSX.read(ab, { type: 'array', cellStyles: true })` 로 읽기.

### 3-3. 템플릿 파일 위치

- **경로:** `public/norang_template.xlsx`
- **배포 시:** 빌드/배포 결과물에 이 파일이 **반드시 포함**되어야 함. 없으면 계속 평면 파일만 다운로드됨.
- **원본:** 부고장 프로젝트 `docs/norang_template.xlsx.xlsx` 를 복사해서 `norang_template.xlsx` 로 저장해 `public/` 에 넣기.

---

## 4. 코드에서 찾을 위치

- `buildYellowBalloonWorkbook` — `fetch('/norang_template.xlsx')` 후 시트 선택·채우기.
- `isMonthSheetName` — 시트 이름이 `숫자+월` 인지 검사.
- `fillYellowBalloonSheet` — 맨 앞에서 `clearYellowBalloonDataRows(ws)` 호출 후 행 채우기.
- `setCell` / `clearYellowBalloonDataRows` — 셀에 쓸 때 기존 `existing.s` 유지.

---

## 5. 확인 방법

1. **로컬:** `npm run dev` 후 명세/내역서 내보내기 → **노랑풍선 엑셀** 선택 → 기간 지정 → 다운로드.
2. 받은 파일명이 **`2026년_N월_채움_결과.xlsx`** 이고, **템플릿 레이아웃**(거래처/임직원/사내조경 블록)에 데이터가 채워져 있으면 성공.
3. **배포 환경:** `https://배포주소/norang_template.xlsx` 로 접속해서 파일이 내려오는지 확인.

---

## 6. 자주 실패하는 이유

- **템플릿 파일 없음** — 배포 시 `public/norang_template.xlsx` 가 빠짐 → 다시 넣고 재배포.
- **시트 이름 불일치** — 템플릿 시트 이름이 `"1월"` 같은 `숫자+월` 형식이 아님 → 엑셀에서 시트 이름 확인.
- **코드 미반영** — pull 후 노랑풍선 수정이 되돌아감 → 위 3장 내용대로 다시 적용.

---

*작성: 2026년 2월 — 노랑풍선 명세서 엑셀 템플릿 반영*
