# 노랑풍선 명세서 작업 내역 (2026년 2월)

> 집에서 이어서 할 때 AI에게 "@dashboard/노랑풍선_명세서_작업내역.md" 붙여 주고 "이거 보면서 이어서 해줘" 하면 됨.

---

## 1. 작업 흐름 정리 (1단계 vs 2단계)

| 단계 | 내용 |
|------|------|
| **1단계** | 거래처에서 접수(부고장/청첩장 URL·캡처) 받으면 → **대시보드에 자동 입력** → (향후) 예약시스템 자동 입력 후 예약 |
| **2단계** | **대시보드에 쌓인 정보**를 → **명세서**로 → **노랑풍선 엑셀 템플릿에 뿌리기** (지금 구현된 것) |

→ 명세서는 "접수에서 바로" 가는 게 아니라, **대시보드 데이터**를 템플릿에 채워 내보내는 구조.

---

## 2. 이번에 한 작업 요약

### 2-1. 템플릿 파일 위치

- **원본:** `c:\개발\부고장\docs\norang_template.xlsx.xlsx` (이름에 .xlsx 두 번 있음)
- **대시보드에서 쓸 위치:** `dashboard/public/norang_template.xlsx`
- **조치:** 원본을 복사해서 **이름을 `norang_template.xlsx`로** 바꿔 `public/`에 넣어 둠. (이미 복사해 둔 상태일 수 있음. 없으면 위 경로에서 복사.)

### 2-2. "대시보드 내용이 템플릿에 안 들어간다" 문제 수정

**원인:**  
- 템플릿에 **"1월" 시트만** 있는데, 2월 등 다른 월로 내보내면 코드가 "2월" 시트를 찾다가 못 찾고 **평면 파일**(`2026년_경조화환발주내역_성원플라워_2026-02-01_2026-02-28.xlsx`)로 떨어짐.  
- 그래서 **템플릿이 그대로 유지되고 그 안에만 내용이 수정**되어야 하는데, 평면 파일이 다운로드됨.

**수정한 파일:** `src/App.tsx`

**수정 내용:**

1. **시트 이름 매칭 보강**
   - 해당 월 시트(예: `"2월"`)가 없어도, **첫 번째 "N월" 형식 시트**(예: `"1월"`)를 찾아서 그 시트에 선택한 월 데이터를 채우도록 함.
   - 함수 `isMonthSheetName(name)` 추가: `"1월"`, `"2월"`처럼 숫자+월 형식(공백·전각 숫자 허용)이면 월 시트로 인식.

2. **템플릿은 그대로 두고 내용만 수정**
   - **setCell**: 기존 셀에 스타일(`s`)이 있으면 **값(`v`)만 바꾸고** 스타일 유지.
   - **clearYellowBalloonDataRows**: 데이터 영역(거래처·임직원·사내조경) 셀을 비울 때도 **값만 지우고** 스타일은 유지.

3. **템플릿 읽기 옵션**
   - `XLSX.read(ab, { type: 'array', cellStyles: true })` 로 읽어서 스타일 정보까지 로드.

### 2-3. 거래명세표(일반양식 HTML) 인쇄 시 2페이지 나오는 문제 — 컬럼 폭 조정

**대상:** 하나투어비즈니스 등 **일반양식** 거래명세표 HTML (`거래명세표_거래처명_날짜.html`). 화면에서는 한 페이지처럼 보이지만 인쇄하면 두 페이지로 나감.

**수정한 파일:** `src/App.tsx` — `buildStatementHtml()` 안의 `<style>` 블록.

**변경 내용:**

| 컬럼 | 변경 전 | 변경 후 | 비고 |
|------|--------|--------|------|
| 품목 | 9% | **11%** | 글자 1개 더 들어가게 폭 확대 |
| 요청부서 | 14% | **20%** | 요청부서·발송 장소 폭 같게 |
| 발송 장소 | 27% | **20%** | 요청부서·발송 장소 폭 같게 |
| 수량 | 8% | **5%** | 수량 컬럼 폭 축소 |

- 엔타스형 명세표(`.entas-sheet`)도 요청인/발송 장소를 각 20%로 동일하게 적용해 둠.

**엔타스형 인쇄 시 줄바꿈 많음:** 인쇄 시 품목·요청인·발송 장소가 여러 줄로 나오는 문제로, **엔타스형 전용** 컬럼 폭을 따로 적용함.

| 컬럼 | 일반/엔타스 공통 | 엔타스형(.entas-sheet) |
|------|------------------|------------------------|
| 월/일 | 6% / 6% | 5% / 5% |
| 품목 | 11% | **20%** (경조+지점명 한 줄에) |
| 요청인 | 20% | **21%** |
| 발송 장소 | 20% | **21%** |
| 수량 | 5% | **4%** |
| 공급가액/세액/금액 | 11% / 6% / 12% | 9% / 5% / 11% |

→ 엔타스형은 품목·요청인·발송 장소를 넓히고, 월/일/수량/금액 쪽을 살짝 줄여 인쇄 시 한 페이지·줄바꿈 감소되도록 함.

---

## 3. 로컬에서 확인하는 방법

1. **Supabase 설정**
   - `.env` 파일에 다음 두 값 설정:
     - `VITE_SUPABASE_URL=https://본인프로젝트.supabase.co`
     - `VITE_SUPABASE_ANON_KEY=본인 anon key`
   - Supabase 대시보드 → Settings → API 에서 Project URL, anon public 키 복사.

2. **실행**
   ```bash
   npm run dev
   ```
   - 브라우저에서 **http://localhost:5173** 접속.

3. **명세서 내보내기 테스트**
   - 대시보드에서 **명세/내역서 내보내기** → **노랑풍선 엑셀** 선택.
   - 기간(날짜 from/to) 지정 후 다운로드.
   - 받은 파일이 **`2026년_N월_채움_결과.xlsx`** 형태이고, **템플릿 레이아웃 안에 대시보드 데이터가 채워져 있으면** 정상.

---

## 4. 참고 문서·경로

- **노랑풍선 템플릿 안내:** `public/노랑풍선_템플릿_안내.txt`
- **부고장 접수·명세서 계획:** `c:\개발\부고장\docs\부고장_접수_계획.md`, `노랑풍선_명세서_작업정리.md`
- **템플릿 구조:** 시트 "1월" 등 N월, 거래처 4~24행, 임직원 27~31행, 사내조경 32행, 컬럼 A~K (구분, No, 배달일자, 상품명, 발주자, 배송지, 거래처명/사유, 요청팀, 수령인, 금액, 비고)

---

## 5. 배포 시 체크

- **Vercel 등**에 배포할 때 `public/norang_template.xlsx` 가 **빌드 결과물에 포함**되는지 확인.
- 브라우저에서 `https://배포주소/norang_template.xlsx` 로 접속해 보면, 템플릿 파일이 내려오는지 확인 가능.
- 이 파일이 없으면 노랑풍선 엑셀 내보내기 시 계속 **평면 파일**만 받게 됨.

---

*정리: 2026년 2월 (회사에서 진행한 노랑풍선 명세서 템플릿 반영·수정 작업)*
